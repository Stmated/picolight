<html>

<head>

    <style>
        html {
            background-color: #333;
        }

        table, tr, td {
            padding: 0;
            margin: 0;
        }

        td {
            width: 5px;
            height: 5px;
        }
    </style>

    <script>
        async function openFile() {

            const e_output = document.getElementById('output');
            document.getElementById('button').remove();

            let fileHandle;
            [fileHandle] = await window.showOpenFilePicker({
                multiple: false,
                types: [
                    { description: 'local_dev_output.txt', accept: { 'text/*': ['.txt'] } }
                ]
            });

            setInterval(async () => {

                const file = await fileHandle.getFile();
                const contents = await file.text();

                const lines = contents.split('\n');

                // TODO: Redo into a rendered SVG instead
                while (e_output.firstChild) {
                    e_output.firstChild.remove()
                }

                const e_table = document.createElement('table');
                e_output.appendChild(e_table);

                for (var i = 0; i < lines.length; i++) {

                    // Every line is an RBG or RGBW value
                    const line = lines[i];
                    const parts = line.split(',');
                    const r = Number.parseInt(parts[0], 10);
                    const g = Number.parseInt(parts[1], 10);
                    const b = Number.parseInt(parts[2], 10);
                    const w = (parts.length > 3) ? Number.parseInt(parts[3], 10) : 0;

                    const e_tr = document.createElement('tr');
                    const e_td = document.createElement('td');

                    // TODO: Implement W somehow
                    e_td.setAttribute('style', 'background-color: rgb(' + r + ',' + g + ', ' + b + ');');

                    e_tr.appendChild(e_td);
                    e_table.appendChild(e_tr);
                }

            }, 1);
        }
    </script>

</head>

<body>

    <input type="button" id="button" value="Click then open 'local_dev_output.txt'" onclick="openFile()" />

    <div id="output">

        </table>

</body>

</html>